<?xml version="1.0" encoding="utf-8"?>
<TeamMentor_Article Metadata_Hash="1444108572" Content_Hash="1153169116">
  <Metadata>
    <Id>9ced5cc7-2dc6-4967-a6f4-4eaedc14c157</Id>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>通常とは異なるアクティビティをログ記録して疑わしいアクションを追跡する</Title>
    <Category>監査とログ記録</Category>
    <Phase>実装</Phase>
    <Technology>ASP.NET 3.5</Technology>
    <Type>チェックリスト項目</Type>
    <DirectLink />
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>チェック対象</h1>
  <p>異常な、または不審なアクティビティを示している可能性があるアプリケーション ログ イベントを確認します。 異常なアクティビティには、古い認証チケットのリプレイや一定期間における非常に多いログインの試行などが挙げられます。</p>
  <h1>理由</h1>
  <p>不審なアクティビティの分析により、潜在的な問題を検出し素早い対応が可能になります。 </p>
  <h1>チェック方法</h1>
  <ol>
    <li>
      <p />
      <strong>ログを行う対象を定義します。 </strong>適切なロギングが行われているかどうかチェックする前に、アプリケーションに対する異常なアクティビティを特定するリストを作成する必要があります。 始めに、次のリストを使用してください。<ul><li>繰り返される認証試行の失敗<li>古いセッションに関する情報または認証チケットの使用を試みている<li>大きな、または高速なトランザクション<li>通常の時間外に発生するトランザクション<li>特にユーザー エラーで簡単には引き起こされないか、または深い階層で発生しているようなアプリケーションのエラー。</li></li></li></li></li></ul><li><p><strong>データがログ記録されていることを確認します。 </strong>異常なアクティビティがどのようなものであるか理解したら、適切にログ記録されていることをチェックします。&nbsp;ログ記録される個別のデータにより、正しいロギングは異なります。 多くのアプリケーションでは、異常なアクティビティが起こると、カスタムイベントが発生します。 </p><li><p><strong>ログを監視するようにする。 </strong>アプリケーションによって監視が必要なものもあります。 適切な監視が実施されており、不審な動きがあった場合に、担当スタッフが対応プランを準備していることを確認します。</p></li></li></li>
  </ol>
  <h1>修正方法</h1>
  <ol>
    <li>
      <p />
      <strong>通常とは異なるアクティビティをアプリケーションに定義します。 </strong>初めに行うべき最も重要な手順は、アプリケーションにとって不審なアクティビティがどのようなものであるかを理解することです。 各アプリケーションの業務は異なるため、アプリケーションごとの詳細を明らかにしておかなければなりません。 たとえば、ロギングはより大きな詐欺防止キャンペーンの一部である可能性があります。 広範囲の様々なアプリケーションタイプにわたって、不審とされるアクティビティがあります。<ul><li>繰り返される認証試行の失敗<li>古いセッションに関する情報または認証チケットの使用を試みている<li>大きな、素早いトランザクション<li>通常の時間外に発生するトランザクション<li>アプリケーションのエラー、特にユーザーによって簡単に起きにくいもの、または深い階層で発生するもの。</li></li></li></li></li></ul><li><p><strong>十分なデータをログ記録します。 </strong>アプリケーションにとって異常なアクティビティが何であるかを理解したら、適切にログ記録されていることを確認します。&nbsp;ログ記録される個別のデータにより、正しいロギングは異なります。 例: 古い認証チケットのリプレイにより自動的に ExpiredTicketFailure イベントが発生する。 過剰なログイン試行があった場合にイベントを発生させるには、<b>Login</b> コントロールの<b>LoginError</b> イベントにイベント ハンドラーを記述します。 ハンドラーで<b>Membership.GetUser(Login1.UserName).IsLockedOut</b> を呼び出し、ユーザーに過剰なログイン試行があるかどうかを判断します。&nbsp;その後、カスタム イベントを立ち上げ、アカウントがロックアウトされたことを示します。&nbsp;カスタム イベントは、様々な非認証関連の異常なアクティビティにも発生させることが可能です。 その他の不審なアクティビティは、アプリケーション固有のアプローチが必要です。 疑わしいアクティビティのログは、既存のログ ファイルをパースして、単一のホストまたはユーザーによる非常に短い時間のトランザクション (通常は大量発注など) といった変則的なアクティビティを特定することにより、最も高い効果が得られる場合があります。</p><li><p><strong>ログを監視するようにする。 </strong>結果が日の目を見なければロギングは意味がありません。次の手順では、ログを監視し、その情報を活用します。 アプリケーションを管理する操作チームと共に、ログ イベントを監視し対応する計画を立てます。 状況に応じて、計画をゼロから立てる必要がある場合もあれば、既存のフレームワークに組み込める場合もあります。 <br />もし監視のフレームワークを位置から定義する場合、気をつけるべきことをここに記します。</p></li><ul><li>ログをいつ監視する必要があるか。アプリケーションによっては、常時監視する必要がありますが、多くは 1 日 8 時間、週 5 日間で十分です。 <li>どの程度の頻度でログを監視するか。アプリケーションが大きな電子商取引サイトの場合、ログを監視する専門チームが必要かもしれませんが、小規模な Web アプリケーションでは、シスアドが 1 日に 2、3 回確認すれば十分安全です。 <li>必要な応答時間—サイトに重要な問題があれば、まずログに表示されます。 問題に対する許容値は、数分ですか、数時間ですか、数日ですか。 <li>潜在的な問題に対処するプロシージャとは? <li>ログやログから導かれる情報に対するアクセスをどのように制御しますか。 それは、どの程度機微な情報と考えられますか。 <li>ログ監視チームにはどのような応答機能がありますか。 その情報に対して対処されない場合、ログ監視のみでは効果がありません – 危険にさらされているアカウントをロックする必要があり、マシンはパッチ修正されるか、ラインから分離します。</li></li></li></li></li></li></ul><li><p><strong>ログの落とし穴を避けます。 </strong>あまりにも多くの情報をログ記録すると、それ自体が問題になる可能性があります。 アプリケーションから確認しているログ イベントのボリュームの見当が付いたら、何らかのログ調整を実施して、対処できる割合まで情報の流れを減らすことは試みる価値があります。 優良なログ スロットルは、重複情報のみを消去し、最初に最重要情報を明示する必要があります。 変則的な状態の検出に基づいて自動的にアクションを起こすことは、非常に危険な行為であり避けることが最善です。 イベント (たとえば、ログイン試行) が発生する速度を調整することは理にかなっていますが、そのアクションを防止すると、実施が容易な DoS 攻撃をアプリケーションが受ける可能性があります。 </p></li></li></li>
  </ol>
  <h1>問題の例</h1>
  <p>電子商取引のサイトでは1時間に何百ものトランザクションがありますが、ベーシックなウェブサーバとデータベース トランザクション ログのみを使っています。&nbsp;攻撃者がログインスクリプトに脆弱性を見つけ、多くのトランザクションを行うために複数のアカウントを盗んだ場合、商品発送後まで侵入を発見することはできません。&nbsp;</p>
  <h1>ソリューションの例</h1>
  <p>ある電子商取引サイトは、1 時間に数百件のトランザクションを処理し、通常とは異なるアプリケーションのアクティビティを記録する専用のセキュリティ ログを保管しています。&nbsp;攻撃に素早く対処できるサイトのオペレーションチームが1日24時間1週間休みなくログを監視し、必要に応じて開発者にも連絡します。&nbsp;ログには次のカテゴリーの情報が含まれます(その他多数)</p>
  <ul>
    <li>同じアカウントに対する、または同じアドレスからの複数回のログイン失敗<li>顧客の履歴、サイトの平均と比較して異常に大きなトランザクション。<li>同じ顧客からの複数回の早急なトランザクション<li>セキュリティ クリティカル システムからのあらゆる例外、httpエラーまたはSQLエラー</li></li></li></li>
  </ul>
  <p>攻撃者がログイン スクリプトに脆弱性を見つけ、複数のアカウントを盗みだそうとした場合、24時間体制のモニタリング チームが即座にログ内でその動きを見つけ、アカウントをロックして攻撃者をブロックし、開発者と協力して修正を行います。</p>
  <h1>関連ガイドライン</h1>
  <ul>
    <li>
      <a href="/article/dd1a00d0-7951-43f8-8f13-a719348b1b02">ガイドライン: 通常とは異なるアクティビティに備えてアプリケーションを装備する</a>
    </li>
  </ul>
  <p />
  <hr />
  <p />
  <p>出典: Microsoft patterns & practices guidance </p>]]></Data>
  </Content>
</TeamMentor_Article>