<?xml version="1.0" encoding="utf-8"?>
<TeamMentor_Article Metadata_Hash="-271532027" Content_Hash="1468721963">
  <Metadata>
    <Id>6a2aa67d-b6e3-4fb0-b6aa-66a72e972738</Id>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>ネットワーク盗聴のバグのテスト方法</Title>
    <Category>ネットワーキング</Category>
    <Phase>テスト</Phase>
    <Technology> 任意</Technology>
    <Type>その方法</Type>
    <DirectLink />
    <Tag />
    <Security_Demand />
    <Author />
    <Priority />
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<p />
  <p>
    <b>
      <span>
      </span>
    </b>
  </p>
  <h1>
    <span>対象</span>
  </h1>
  <ul>
    <li>コンピュータ ネットワーク</li>
  </ul>
  <p>&nbsp;</p>
  <h1>
    <span>要約</span>
  </h1>
  <p>ネットワーク盗聴攻撃またはネットワーク スニッフィング攻撃は、2 つのターゲット ネットワーク ノード間のネットワーク トラフィックを傍受し、ノード間で交換されるネットワーク パケットをキャプチャーします。<span> </span>攻撃者は一般的に、この脆弱性を利用してユーザーのパスワードなどの機密情報を取得します。 この攻撃は、ハブやスイッチで相互接続されたローカル エリア ネットワーク (LAN) や無線ローカル エリア ネットワーク (WLAN) など、様々な環境に適用されます。 </p>
  <p>ネットワーク盗聴のバグをテストするには以下の手順を実行します。</p>
  <ul>
    <li>手順 1: 攻撃のシナリオを理解する<li>手順 2: 原因と対策を分析する<li>手順 3: テスト ケースを実行する</li></li></li>
  </ul>
  <p>&nbsp;</p>
  <h1>
    <span>手順 1: 攻撃シナリオを理解する</span>
  </h1>
  <p>最初に、このバグに関連する様々な攻撃シナリオを理解する必要があります。</p>
  <ul>
    <li>ハブを使用するネットワーク<li>スイッチド ネットワーク<li>WLAN ネットワーク<li>インターネットのパケットのスニッフィング</li></li></li></li>
  </ul>
  <h2>
    <span>
      <em>シナリオ 1: ハブを使用するネットワーク</em>
    </span>
  </h2>
  <p>ハブ型ネットワークは、ハブに接続されたすべてのホストにすべてのネットワーク フレームを送信することで機能します。 ハブからのフレームを受信した各ホストは、フレームが自分宛であるかどうかを確認します。 自分宛である場合、ホストはフレームを処理します。 そうでない場合、ホストはフレームを無視します。</p>
  <p>このシナリオでは、攻撃者はターゲット ホストと同じハブに接続します。<span>&nbsp; </span>その後、攻撃者は無作為検出モードでネットワーク トラフィックのモニタリングを開始し、ターゲット ホストに送信されるすべてのパケットをキャプチャーします。</p>
  <p>詳細: </p>
  <ol>
    <li>攻撃者はターゲット ノードの 1 つと同じハブに接続します。<li>攻撃者は無作為検出モードでネットワーク モニタリング ツールを実行し、ホスト間で交換されるパケットをキャプチャーします。</li></li>
  </ol>
  <p>
    <b>
      <i>
        <span>
        </span>
      </i>
    </b>
  </p>
  <h2>
    <span>
      <em>シナリオ 2: スイッチド LAN</em>
    </span>
  </h2>
  <p>スイッチド ネットワークはハブ型ネットワークとは異なり、ブロードキャストの原則に従いません。 スイッチは受信先に応じて、スイッチに接続されたホストに単独でフレームを送信します。 そのため、攻撃者は同じスイッチに接続した後、スイッチとターゲット ホストの間のネットワーク トラフィックが攻撃者を通るようにリダイレクトする追加操作を行う必要があります。 一般的にこの操作には、ARP ポイズニング攻撃を使用しますが、DHCP スプーフィング、ポート スティーリング、DNS スプーフィングなどの攻撃が使用される場合もあります。</p>
  <p>詳細: </p>
  <ol>
    <li>攻撃者はターゲット ノードの 1 つと同じスイッチに接続します。<li>攻撃者はスイッチ内で、スイッチとターゲット ノードの間のネットワーク トラフィックを複製/リダイレクトする攻撃を実行します。<li>攻撃者はネットワーク モニタリング ツールを使用し、2 つのホスト間で交換されるパケットをキャプチャーします。&nbsp;</li></li></li>
  </ol>
  <h2>
    <span>
      <em>シナリオ 3: WLAN ネットワーク</em>
    </span>
  </h2>
  <p>無線ローカル エリア ネットワーク (WLAN) は、無線でアクセス ポイント (または基地局) に接続されたホスト コンピュータのセットで構成され、アクセス ポイント (または基地局) は従来型の有線接続でハブやスイッチに物理的に接続されます。 無線ネットワークは、保護手段をとらずにあらゆるコンピュータの参加を許可することも、コンピュータがネットワークに参加するためには鍵が必要となるように暗号化することもできます。<span> </span><span>&nbsp;&nbsp;</span></p>
  <p>このシナリオでは、攻撃者はハブまたはスイッチの傍受と同じ手順を実行します。 ただし、攻撃者が最初にネットワークに参加しなければならない点のみが異なります。 ネットワークが保護されていない場合、ネットワークへの参加は簡単です。 攻撃者は、無線インターフェイスを用意して WLAN のアクセス ポイント付近に移動するだけでネットワークに参加できます。 WLAN が暗号化されている場合、攻撃者は最初にネットワークの暗号鍵を入手してからネットワークに参加する必要があります。 WLAN に参加した攻撃者は、無作為検出モードですべてのパケットの取得を開始するか (アクセス ポイントがハブの前にある場合)、ARP ポイズニングなどの追加攻撃を実行して (アクセス ポイントがスイッチの前にある場合)、攻撃を完了します。 無線アクセス ポイントの構成を適切に行うと、この攻撃を軽減できます。</p>
  <h2>
    <em>シナリオ 4: インターネットのパケットのスニッフィング</em>
  </h2>
  <p>距離のあるノード間で発生するネットワーク接続は、インターネットを介して伝達される必要があります。 これらは通常、<span> </span>インターネット サービス プロバイダー (ISP) によって設定された一連のルーターによって送信されます。 このシナリオでは、攻撃者はターゲット ノードのと同じ LAN または WLAN には存在しません。 攻撃者はインターネット上のどこかに存在し、実際に盗聴しているかのような攻撃を実行します。 この攻撃には 2 つの方法があります。 最初の方法では、攻撃者はボーダー ゲートウェイ プロトコル (BGP) の設計上の欠陥をプログラムでエクスプロイトします。 ユーザーがサイトに移動すると、DNS サーバはユーザーのコンピュータに目的地の IP を提供します。 その後この IP はユーザーの ISPに属する BGP テーブルで検索され、要求に対して最適なルートが探し出されます。 しかし、BGP は信頼に基づいて機能し、あらゆる ISP やネットワークが様々な IP アドレスや元の IP へのルートを通知することを許可します。 攻撃者はターゲット ノードの IP の 1 つに対して悪意のあるルートを通知し、ルーターを侵害して傍受攻撃を実行できます。 2 つめの方法では、悪意のある ISP プロバイダーがすべてのルーターに無制限にアクセスし、ルーターを通過するすべての接続の内容を読み取ります。 機微データが暗号化されずに伝達されると、悪意のある ISP 管理者によって容易に読み取られる可能性があります。</p>
  <p>&nbsp;</p>
  <h1>
    <span>手順 2: 原因と対策を分析する</span>
  </h1>
  <p>次に、ネットワーク盗聴攻撃の原因とその防止策を理解する必要があります。<b><i><span></span></i></b></p>
  <h2>
    <span>
      <em>ネットワーク レベルの保護</em>
    </span>
  </h2>
  <p>傍受攻撃に対する保護の第 1 の方法は、ネットワーク レベルで行うため、ネットワークの種類に左右されます。</p>
  <h2>
    <span>
      <em>ハブ型ネットワーク</em>
    </span>
  </h2>
  <p>ハブを介して接続するネットワークには、設計上、傍受攻撃に対する脆弱性があります。 前のセクションで説明したとおり、ハブで構成される LAN は、ハブに接続されたすべてのホストにネットワーク フレームを送信することで機能します。 ハブ型ネットワークへのネットワーク盗聴攻撃は、無作為検出モードでパケットをスニッフィングするだけで実行可能です。無作為検出モードとは、ネットワーク インターフェイスの操作モードの 1 つで、コンピュータを通過する各パケットは、そのコンピュータが宛先でない場合も含めてすべて読み取ることができます。 この方法により攻撃者は、ホストを対象としないすべてのパケットを破棄することなく、攻撃者のコンピュータによって読み取られることを想定しないものも含めて、すべてのパケットの内容を読み取れます。 このシナリオを防止するため、管理者は Anti Sniff (<a href="http://packetstormsecurity.org/sniffers/antisniff/">http://packetstormsecurity.org/sniffers/antisniff/</a>) などのネットワーク ツールを実行し、無作為検出モードのインターフェイスを保持しているコンピュータを検出する必要があります。</p>
  <h2>
    <span>
      <em>スイッチド ネットワーク</em>
    </span>
  </h2>
  <p>スイッチド ネットワークでのネットワーク盗聴攻撃は様々な要因によって発生し、LAN 上のスイッチとターゲット ホストの間のトラフィックをリダイレクト/複製するための条件に左右されます (前のセクションのシナリオ 2 を参照)。 これらの方法には、ARP ポイズニング、DHCP スプーフィング、DNS スプーフィング、ポート スティーリングのエクスプロイトの一部として、ネットワーク トラフィックのスニッフィングを目的とする、スイッチ ネットワークへの中間者攻撃が含まれます。<span> </span></p>
  <p>各シナリオを防止するため、ネットワーク管理者は各ケースに応じた対策を実行する必要があります。 たとえば、攻撃が ARP ポイズニングによって実行される場合、ARP プロトコルでリモート ARP テーブルの変更が可能な設計になっていることが原因であると考えられます。 ネットワーク管理者は ARP ポイズニングに対し、ネットワーク検査ツールを使用してネットワーク レベルの保護を実行したり、Xarp などのツールを使用してホスト レベルの保護を実行したりできます。 詳細については、<i>「ARP ポイズニングのバグのテスト方法」</i>を参照してください。同じことが、攻撃の種類に応じて固有の保護が必要なその他の攻撃にもあてはまります。 ネットワーク スイッチに対する中間者攻撃の詳細については、<span></span><i>「中間者攻撃バグのテスト方法」</i>を参照してください。<i></i></p>
  <h2>
    <span>
      <em>無線ネットワーク</em>
    </span>
  </h2>
  <p>無線ネットワークの攻撃に対する脆弱性には 2 つの理由があります。<span> </span></p>
  <p>脆弱性の 1 つめの理由は、無線ネットワークが攻撃者のネットワークへの参加を許可することにあります。 これは WLAN のアクセス ポイントが保護されていない/暗号化されていないために、誰もがネットワークに参加できる場合に発生します。 この状況を防止するため、ネットワーク管理者は適切な暗号化を使用する必要があります (WPA: Wireless Protected Access および WEP: Wired Equivalent Privacy)。 これらのプロトコルは暗号攻撃のターゲットとなっているため、十分なサイズの鍵 (128 ビット以上) と強力なパスワードを構成する必要があります。</p>
  <p>WLAN へのアクセスを保護することに加えて、アクセス ポイントがハブの前にあるか、スイッチの前にあるかに応じて上記の対策を実行し、ネットワーク盗聴攻撃を防止する必要があります。<span> </span></p>
  <h2>
    <span>
      <em>BGP 攻撃</em>
    </span>
  </h2>
  <p>BGP 攻撃は、認証されていない BGP テーブルの更新を許可する BGP プロトコルの性質を利用した攻撃です。 BGP 攻撃を防止するには、ルート フィルタリングや安全な BGP (S-BGP) などの手法を使用します。 適切なルーター フィルターを設定すると、ルーターは既定のルートのみを許可し、攻撃者によって設定されている可能性のある悪意のあるルートをすべてブロックするため、悪意のある更新を防止できます。 S-BGP はさらに安全で、ルーターが更新を実行する前に、ルーターの強力な認証 (公開鍵の暗号化に基づきます) が必要で、接続された BGP ルーター間で IPSec を使用して認可されていないルーターからの保護を実行します。 ただし、S-BGP を適切に実装するには、各ルーターで S-BGP を使用することについて多くの ISP の同意を得る必要があります。</p>
  <h2>
    <span>
      <em>アプリケーション/設定レベルでの暗号化の使用</em>
    </span>
  </h2>
  <p>開発者は、ネットワーク上で送信される機微データを暗号化することで、これらのネットワーク レベルの保護を補う必要があります。 暗号化してからネットワーク上で送信される機微データは、傍受攻撃が成功しただけで読み取られることはありません。 スニッフィングされたパケット内で攻撃者が確認できるのは暗号文だけで、実際の機微データをプレーンテキストで確認することはできません。 暗号化プロトコルの中には認証と連動するものがあります (受信先が適切であるかどうかを確認します)。 たとえば、開発者は、暗号化および認証で TLS/SSL や IPSec などを使用することや、暗号化した電子メール メッセージや機密ファイルの送信で PGP を使用することを検討する必要があります。 ウェブ アプリケーションは、クライアントからのログイン要求をアプリケーションに送信する前に暗号化する必要があります。 この条件は、ASP .NET などのフレームワークで、Forms Authentication を使用し、SSL 要求フラグを設定することで容易に実現できます。 同様に、Web 開発者は、クッキーを SSL 要求としてマークし、Cookie 内で機微データが暗号化されていない状態で送信されないようにできます。</p>
  <p>&nbsp;</p>
  <h1>
    <span>手順 3: テスト ケースの実行</span>
  </h1>
  <p>ネットワーク盗聴攻撃のすべての論理的側面を検討した後は、テスト ケースを実行してネットワークの脆弱性を確認する必要があります。</p>
  <h2>
    <span>
      <em>ハブ型 LAN でのネットワーク盗聴攻撃のテスト</em>
    </span>
  </h2>
  <p>ハブ型 LAN でのネットワーク盗聴をテストするには以下の手順を実行します。<b><i><span></span></i></b></p>
  <ol>
    <li>コンピュータをターゲット ホストと同じハブに接続します。<li>Wireshark (<span></span><a href="http://www.wireshark.org/download.html">http://www.wireshark.org/download.html</a>) をダウンロードしてインストールします。<li>Wireshark を起動し、ハブ型ネットワークに対応するインターフェイスからのネットワーク トラフィックのキャプチャーを開始します。<span> </span>必ず無作為検出モードでキャプチャーを開始してください。</li></li></li>
  </ol>
  <p>予測結果: ターゲット ホストに脆弱性がある場合、ターゲット ホストで送受信されるパケットで、キャプチャーされたものが Wireshark に表示されます。&nbsp;</p>
  <h2>
    <span>
      <em>スイッチド LAN でのネットワーク盗聴のテスト</em>
    </span>
  </h2>
  <p>スイッチド LAN でネットワーク盗聴をテストするには、以下の手順を実行します。<b><i><span></span></i></b></p>
  <ol>
    <li>コンピュータをターゲット ホストと同じスイッチに接続します。<li>Cain (<a href="http://www.oxid.it/cain.html">http://www.oxid.it/cain.html</a>) および Wireshark (<span></span><a href="http://www.wireshark.org/download.html">http://www.wireshark.org/download.html</a>) をダウンロードしてインストールします。<li>Cain を実行します。 <li>メニューで <b>構成</b> をクリックし、ネットワーク インターフェイスを選択します (次のテスト ケースでは無線インターフェイスとなる場合があることに注意してください)。<li> <b>[Sniffer] (スニッファー)</b> タブ、<b>[Hosts] (ホスト)</b> サブタブの順にクリックします。<li>スニッファーを起動し、プラス (<b>+</b>) 記号をクリックします。<li>一定範囲の IP を選択してそれぞれの MAC アドレスをスキャンし (範囲内にターゲット ボックスも含めます)、<b>[OK]</b> をクリックします。ゲートウェイとターゲットホストの両方の IP (およびそれぞれの MAC) がホスト リストに表示されます。<li><b>[ARP poisoning] (ARP ポイズニング)</b> サブタブをクリックします。<li>プラス (<b>+</b>) 記号をクリックし、攻撃対象からの ARP ルートをゲートウェイに追加します。<li>[ARP] ボタンを押し、ARP ポイズニング攻撃を開始します。 攻撃対象がアクティブになると、ステータスはすぐに [idle] (アイドル) から [poisoning] (ポイズニング) に変化します。<span> </span>下側のペインに傍受されたパケットが表示され始めます。<li>Wireshark を起動し、Cain で選択したインターフェイスからのネットワーク トラフィックのキャプチャーを開始します。</li></li></li></li></li></li></li></li></li></li></li>
  </ol>
  <p>予測結果: ARP ポイズニング攻撃は、成功すると Cain とWireshark の両方に表示されます。 Cain では、[Sniffer] (スニッファー) &gt; [ARP] タブの下側のペインにスニッフィングされたパケットが表示されます。 <span>&nbsp;</span>ターゲット ホストに脆弱性がある場合、ターゲット ホストで送受信されるパケットでキャプチャーされたものが Wireshark に表示されます。</p>
  <p>
    <b>
      <i>
        <span>
        </span>
      </i>
    </b>
  </p>
  <h2>
    <span>
      <em>WLAN でのネットワーク盗聴のテスト</em>
    </span>
  </h2>
  <p>WLAN のネットワーク盗聴をテストするには以下の手順を実行します。<b><i><span></span></i></b></p>
  <ol>
    <li>WLAN が保護されていない/暗号化されていない場合は、手順 4 に進みます。<li>Aircrack (<a href="http://www.aircrack-ng.org/doku.php">http://www.aircrack-ng.org/doku.php</a>) などの WEP/WAP クラッキング ツールをダウンロードします。<li>Aircrack を使用して暗号化を無効化し、WLAN に接続します。<li>ネットワークへの接続後、アクセス ポイントがスイッチとハブ0のどちらで接続されているかに基づいて、上記の 2 つのテストケースのいずれかを実行します。</li></li></li></li>
  </ol>
  <p>予測結果: WLAN が保護されている場合、手順 3 の暗号攻撃は拒否されるため、手順 4 の傍受攻撃を加えることは不可能です。 ネットワークが保護されていない場合、テスト ケース シナリオ (ハブまたはスイッチ) に応じて、手順 4 の傍受攻撃を確認する必要があります。</p>
  <h2>
    <span>
      <em>BGP ルーターでのネットワーク盗聴のテスト</em>
    </span>
  </h2>
  <p>BGP ルーターのネットワーク盗聴をテストするには以下の手順を実行します。<b><i><span></span></i></b></p>
  <ol>
    <li>2 つのターゲット ノードの LAN/WLAN 外部のコンピュータにログインします。<li>ターゲット ノードの 1 つの IP を発見します。<li>ターゲット ノードの 1 つの BGP ルーターを発見します。<li>手順 2 で発見したルーターに <i>UDPATE</i> BGP パケットを送信し、テストするコンピュータに対して、宛先 IP アドレス (手順 1 で発見) への偽のルートを通知します。</li></li></li></li>
  </ol>
  <p>予測結果: ルーターの BGP テーブルが手順 4 で通知された偽のルートに変更される場合、ルーターには脆弱性があります。</p>
  <p>&nbsp;</p>
  <h1>
    <span>結論</span>
  </h1>
  <p>ネットワーク盗聴攻撃では、2 つのターゲット ノード間のネットワーク トラフィックのモニタリングが行われます。<span> </span>攻撃は、ハブ型 LAN、スイッチド LAN、WLAN などの2 つのターゲット ノードのうちの 1 つのネットワークに参加することで実行されます。<span> </span>ネットワークに参加した攻撃者は、ネットワークの種類に応じて様々な手法を使用し、ネットワーク トラフィックのキャプチャーを開始します。 たとえばハブ型ネットワークでは、攻撃者はネットワーク スニッファーを無作為検出モードで実行するだけで傍受攻撃を実行できますが、 スイッチド ネットワークでは、さらに ARP ポイズニング攻撃などを行う必要があります。 無線ネットワークでは、攻撃者はアクセス ポイントの後ろのハブまたはスイッチに攻撃を実行する前に、ネットワークに参加する必要があります。 無線アクセス ポイントで暗号化が使用されている場合、テストを続行する前に暗号を回避する必要があります。 <span>&nbsp;</span>これらの攻撃に対しては、それぞれの種類に応じた固有の防止策を実行する必要があります。 これらの攻撃のテストを行う際は、ネットワーク攻撃や監視ツールを利用します。<b><i><span></span></i></b></p>
  <div>
    <br />
  </div>
  <div>
    <hr />
  </div>
  <p>
    <span>[i] <strong>Revealed: The Internet's Biggest Security Hole. </strong><a href="http://blog.wired.com/27bstroke6/2008/08/revealed-the-in.html">http://blog.wired.com/27bstroke6/2008/08/revealed-the-in.html</a></span>
  </p>
  <div>
    <p>
      <em>&nbsp;</em>
    </p>
  </div>]]></Data>
  </Content>
</TeamMentor_Article>