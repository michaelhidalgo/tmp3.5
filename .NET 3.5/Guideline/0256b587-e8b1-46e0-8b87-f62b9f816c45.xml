<?xml version="1.0" encoding="utf-8"?>
<TeamMentor_Article Metadata_Hash="-1097528698" Content_Hash="1143006057">
  <Metadata>
    <Id>0256b587-e8b1-46e0-8b87-f62b9f816c45</Id>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>ログ ファイルの保護</Title>
    <Category>監査とログ記録</Category>
    <Phase>実装</Phase>
    <Technology>ASP.NET 3.5</Technology>
    <Type>ガイドライン</Type>
    <DirectLink />
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<br />
  <h1>行うべき事柄</h1>
  <p>アプリケーションのログ記録されたイベントを保護するため、アクセスを制限してください。</p>
  <h1>理由</h1>
  <p>ログ記録されたイベントには、多くの場合、攻撃者がお使いのアプリケーションを狙うために役立つ、アプリケーション内部の詳細が含まれています。</p>
  <h1>状況</h1>
  <p>お使いのアプリケーションが何らかの種類のイベントをログ記録する場合。</p>
  <h1>対策</h1>
  <p>次の手順を実行して、お使いのアプリケーションのログ記録されたイベントを保護してください。</p>
  <ol>
    <li>
      <p>
        <strong>ログの場所を開示しないようにします</strong>：ログの場所はお使いのアプリケーションおよびその管理者だけが知っているべきです。 ログの保管場所をユーザーに開示することは避けます。</p>
      <li>
        <p>
          <strong>適切な ACL を設定します</strong>：お使いのアプリケーションおよびその管理者/開発者だけがログにアクセスできるように、ログの ACL を設定してください。</p>
        <li>
          <p>
            <strong>ログ記録フレームワークをユーザーから遠ざけます</strong>：アプリケーションのユーザーにログ記録フレームワークとの直接のやり取りを許可しないでください。 ログ記録フレームワークは、アプリケーションの性能に関する情報はログ記録されるべきですが、ユーザー指定のデータは保存されるべきでありません。 ユーザー指定の情報を保存することは、攻撃者によるアプリケーション ログへの攻撃の手助けとなります。 ログ記録するデータ、ログ記録する方法、およびログ記録するタイミングを決定するときは、「<a href="/article/a053c4e4-2aad-41b9-b60b-e0fdeffd39f4">重要なセキュリティ操作をログ記録する</a>」および「<a href="/article/fc33dfc5-5210-4656-bc27-e43b16c3c89e">ログ スロットルを検討する</a>」のガイドラインを参照してください。</p>
          <li>
            <p>
              <strong>ログ ファイルに書き込むときは必ず append フラグを使用します</strong>：お使いのアプリケーションで、ログ記録されたイベントがディスク上にあるファイルに保存される場合は、必ずお使いのアプリケーションがログ ファイルに新しいイベントを追加するようにしてください。 ログ ファイルに追加することで、ログ記録された既存のイベントを上書きするリスクを減らすことができます。</p>
            <li>
              <p>
                <strong>ログ ローテーションの使用を検討します</strong>：ログ ローテーションを使用すると、お使いのアプリケーションで大規模なログ リポジトリを処理しなくてもよくなります。 お使いのアプリケーションの動作を妨げずにアプリケーションのログ記録されたイベントの管理および監査を行うことができます。 次の手順に従って、ログ ローテーションを使用します。</p>
              <ul>
                <li>
                  <strong>ローテーション期間を定義します</strong>。ログの定期的なローテーションのスケジュールを設定します。 たとえば、月曜ごとにログをローテーションします。 <li><strong>新規のログ ファイルを作成します</strong>：お使いのアプリケーションで、ログ記録されたイベントがディスク上にあるファイルに保存される場合は、アプリケーションでログをローテーションさせる必要があるときに新規のログ ファイルを作成してください。 新しいログ ファイルを作成期間に関連付けておくことをお勧めします。 たとえば、2007年10月16日の週に対応するログファイルには 20071016.log という名前が付けられます。 <li><strong>既存のログをバックアップします</strong>：お使いのアプリケーションでログ リポジトリをローテーションさせる必要がある場合は、既存のログをバックアップしてください。 内部監査ポリシーを参照して、ログのバックアップを保管する期間を決定してください。 アプリケーションがログをバックアップする場合は、現在のログの保管環境と同程度にセキュリティ保護された環境に保管します。</li></li></li>
              </ul>
              <li>
                <p>
                  <strong>外部のログ アプリケーションの使用を検討します。</strong> 外部のログ記録アプリケーションを使用することで、お使いのアプリケーションが突然停止した場合でもアプリケーションのログが最新の状態に保たれます。</p>
                <li>
                  <p>
                    <strong>ASP.NET ヘルス モニタリングをセキュリティで保護します。</strong> お使いのアプリケーションで ASP.NET ヘルス モニタリングを使用する場合は、次の対策を講じることを検討してください。</p>
                  <ul>
                    <li>
                      <strong>アプリケーションのログをログ スロットルする</strong>：「<a href="/article/fc33dfc5-5210-4656-bc27-e43b16c3c89e">ログ スロットルを検討する</a>」のガイドラインを使用してお使いのアプリケーション ログをログ スロットルしてください。 <li><strong>ヘルス モニタリングをセキュリティで保護します</strong>：アプリケーションのログ記録フレームワークをセキュリティで保護する場合は、「ASP.NET ヘルス モニタリングをセキュリティで保護する」&amp;nbsp;(<a href="http://msdn.microsoft.com/en-us/library/ms228045(VS.80).aspx">http://msdn.microsoft.com/en-us/library/ms228045(VS.80).aspx</a>)&amp;nbspを参照してください。 <li><strong>接続文字列をセキュリティで保護します</strong>：「<a href="/article/e1992e93-39c6-4508-9b16-0e07b0939c37">接続文字列をセキュリティで保護する</a>」のガイドラインに従って、お使いのアプリケーションのログ記録フレームワークが使用する、すべての接続文字列をセキュアにしてください。</li></li></li>
                  </ul>
                </li>
              </li>
            </li>
          </li>
        </li>
      </li>
    </li>
  </ol>
  <h1>問題の例</h1>
  <p>電子商取引サイトでは1時間に数百ものトランザクションが行われ､すべてのユーザーとセキュリティ関連のイベントを監視する別のセキュリティログと共に、ウェブおよびデータベースレベルでデータをログ記録しています。 不運にも、セキュリティ ログは、アプリケーションのディレクトリ ツリーに隠された場所に保存されています。 攻撃者は、ログの場所を見つけ、すべてのユーザーとセキュリティ関連イベントを読み取ります。</p>
  <h1>ソリューションの例</h1>
  <p>電子商取引サイトでは1時間に数百ものトランザクションが行われ､すべてのユーザーとセキュリティ関連のイベントを監視する別のセキュリティログと共に、ウェブおよびデータベースレベルでデータをログ記録しています。 ログは運用チームによって年中無休、24 時間体制で監視および管理が行われるセキュアな場所でローテーションされて保存されるため、攻撃者は内部関係者の支援を得ずにログ記録されたイベントにアクセスすることはできません。</p>
  <h1>その他のリソース</h1>
  <ul>
    <li>ログ ファイルへの安全なファイルシステムのアクセス許可を設定する方法の詳細については、「<a href="http://support.microsoft.com/kb/310361">Windows 2000 で IIS 5.0 ログ ファイルおよび仮想ディレクトリに安全な NTFS アクセス許可を設定する方法</a>」を参照してください。<li>IIS でのログ ローテーションの詳細については、「<a href="http://support.microsoft.com/kb/324091">ハウツー：ログ ファイルを閲覧して報告する</a>」を参照してください。<li>ASP.NET ヘルス モニタリングのセキュリティ保護の詳細については、「<a href="http://msdn2.microsoft.com/en-us/library/ms228045(VS.80).aspx">ASP.NET ヘルス モニタリングをセキュリティで保護する</a>」を参照してください。</li></li></li>
  </ul>
  <h1>関連する項目</h1>
  <ul>
    <li>
      <a href="/article/a053c4e4-2aad-41b9-b60b-e0fdeffd39f4">ガイドライン：重要なセキュリティ操作をログ記録する</a>
      <li>
        <a href="/article/fc33dfc5-5210-4656-bc27-e43b16c3c89e">ガイドライン：ログ スロットルを検討する</a>
        <li>
          <a href="/article/e1992e93-39c6-4508-9b16-0e07b0939c37">ガイドライン：接続文字列をセキュリティで保護する</a>
          <li>
            <a href="/article/ce899ba6-8ae2-4494-8706-ce863fae58e7">ガイドライン: ユーザーが指定したすべてのファイル名とパス入力をフィルター</a>
            <li>
              <a href="/article/a19926c9-3e4f-4d5c-8dc1-1baa3748bcda">チェックリスト項目：ログ ファイルは保護されている</a>
            </li>
          </li>
        </li>
      </li>
    </li>
  </ul>
  <hr />
  <p>出典: Microsoft Patterns &amp; Practices ガイダンス </p>]]></Data>
  </Content>
</TeamMentor_Article>