<?xml version="1.0" encoding="utf-8"?>
<TeamMentor_Article Metadata_Hash="-249129136" Content_Hash="-1477699680">
  <Metadata>
    <Id>23c21386-b64a-4872-8727-714977ba84a4</Id>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>使用されなくなった機微データをメモリから消去する</Title>
    <Category>機密のデータ</Category>
    <Phase>実装</Phase>
    <Technology>ASP.NET 3.5</Technology>
    <Type>ガイドライン</Type>
    <DirectLink />
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>行うべき事柄</h1>
  <p>暗号鍵や非公開情報などの機微データは、必要最小限の期間だけメモリに保持されなければなりません。 そのデータが必要なくなったら、ただちにメモリから削除する必要があります。 スワップ ファイルに流出することがないように、すべての痕跡を完全に消去する必要があります。</p>
  <h1>理由</h1>
  <p>厳密に必要な時間以上にメモリに残っている機微データは、ディスクにスワップされる高いリスクがあります。 これにより、アプリケーションの終了後もデータの断片が利用可能な状態のまま残ってしまう可能性があります。 このようなデータは、ディスク、一時ファイル、またはスワップ ファイルのコンテンツを検査することで収集される場合があります。</p>
  <h1>状況</h1>
  <p>アプリケーションが機微データを扱う場合。</p>
  <h1>対策</h1>
  <p>機微データは、機微なデータが格納されていたメモリを上書きすることで消去できます。 割り当て解除されたメモリがコレクションまたは再利用される時期について.NETガーベジ コレクタは何の保証もしないので、メモリの割り当て解除だけでは不十分です。 機微なデータを新しいバッファに割り当てた場合、またはパラメーターとして渡した場合は常に、機微データがコピーされ、メモリの新しいロケーションに存在していることに注意してください。 メモリを消去する場合は、すべてのインスタンスを消去するようにしてください。</p>
  <p>パスワードを扱う場合は以下の考慮事項に注意してください。</p>
  <ol>
    <li>
      <p>
        <strong>機密情報を識別します。 </strong>機微データとは、秘密に保たれており、認可されている当事者にのみ開示するべき情報のことです。 機微データの典型的な例として、以下に限定されませんが、顧客名、政府発行のID番号、クレジット カードまたその他の財務情報、パスワード、および私有鍵などが含まれます｡ ヘルス ケアや銀行など一部の業界では、機密情報を定義する規制基準を設けています。 アプリケーションに規制要件が適用される場合、規制要件に従って機微データを識別します。 機微データは次のように定義されます:</p>
      <ul>
        <li>Personally Identifiable Informationが含まれるか、またはPersonally Identifiable Informationの導出に使用できる、他者と共有すべきでない情報。 <li>ユーザーが提供する情報で、アプリケーションの他のユーザーと共有することが望まれないもの。 <li>外部の信頼できる情報源から得られた情報で、ユーザーと共有することは意図されていないもの。</li></li></li>
      </ul>
      <li>
        <p>
          <strong>機微データのすべての使用状況を確認します。 </strong>機微データを処理する関数およびデータ メンバーの両方を含む、すべてのコード セグメントを特定します。 これらはアプリケーション全体に散在する関数およびデータ構造である可能性があります。 可能な場合､機微データを取り扱うすべてのコードを集中化してください｡</p>
        <li>
          <p>
            <strong>機微データを可変オブジェクトに格納します。</strong> 可変オブジェクトでは、格納しているデータを上書きできます。 .NETではオブジェクトはガーベジ コレクタを通じて割り当て解除する必要があるので、このことは特に有用です。 そのため、現在のプロセス空間から機微データの割り当てが解除されるタイミングが不確かとなります。 ミュータブルなオブジェクトの例としては、文字配列  (すなわち、char&amp;#91;&amp;#93;) があります。しかし、.NET 文字列はミュータブルなオブジェクトではありません。このため、割り当てを行うと現在のメモリ空間は変更できなくなります。そのため、いったん割り当てられたメモリ空間を変更することはできません。 機微データを配列に保存する場合､必ずbyte、char、intのようなプリミティブなデータタイプの配列を使用してください。ただし、.NETがByte、CharまたはInt32のようなプリミティブなタイプ用に提供するラッパークラスの配列は避けます｡ .NET文字列の使用を強制される場合(例えば、.NET文字列が取る関数を呼び出す時など)は、使用直前に文字列を構築するようにし、迅速なガーベジコレクションを促進するため終了次第新しい値を割り当ててください; これは次善策であり、セキュリティ問題につながる可能性がありますが、.NET APIが変更可能なオブジェクトまたはSecureStringsの独占使用を許可するまでは、これは避けられないかもしれません。</p>
          <li>
            <p>
              <strong>すべての機微データのインスタンスを消去します。</strong> 機微データが保存されたメモリ ロケーションが、使用後すべて消去または上書きされたか確認してください。 機微データ インスタンスへのポインターを失うと、その特定のメモリを消去できず、機微なデータの漏えいを許します。</p>
          </li>
        </li>
      </li>
    </li>
  </ol>
  <h1>問題の例</h1>
  <p>以下のコードでは、パスワードを使用しています。 文字列へのポインターが取り外されガーベジコレクションが呼ばれますが、.NETはデータが消去されることを保証しません。</p>
 <pre>string pass = GetPassword();<br />...<br />pass = null;<br />GC.Collect();</pre>
  <h1>ソリューションの例</h1>
  <p>以下のコードでは、パスワードを使用しています。 パスワードの使用後、メモリが明示的に消去されています。 文字列は不変オブジェクトであるため、このコードでは文字配列を使用してパスワードを格納しています。 これで、データを使用後に上書きできるようになります。 </p>
 <pre>char&amp;#91;&amp;#93;pass = GetPassword();<br />...<br />ClearPassword(pass);<br />pass = null;<br />...<br />void ClearPassword(char&amp;#91;&amp;#93;pass)<br />&amp;#123;<br />      for(int i=0; i&lt;pass.Length; i&amp;#43;&amp;#43;)<br />      &amp;#123;<br />            pass&amp;#91;i&amp;#93; = ' ';<br />      &amp;#125;<br />&amp;#125;</pre>
  <h1>その他のリソース</h1>
  <ul>
    <li>.NET のガーベジ コレクタの詳細については、MSDN の「<a href="http://msdn2.microsoft.com/en-us/library/system.gc(vs.80).aspx">GC クラス</a>に関する文書」を参照してください。 <li>.NET のデータ型の詳細については、「<a href="http://msdn.microsoft.com/en-us/magazine/cc301569.aspx">.NET 型の基本</a>」を参照してください。</li></li>
  </ul>
  <h1>関連する項目</h1>
  <ul>
    <li>
      <a href="/article/48ebd4c2-b51d-47b6-8c4c-f7bc37edfb1f">チェックリスト項目：機微データは使用されなくなったらメモリから消去される</a>
    </li>
  </ul>
  <hr />
  <p>出典: Microsoft Patterns &amp; Practices ガイダンス </p>]]></Data>
  </Content>
</TeamMentor_Article>