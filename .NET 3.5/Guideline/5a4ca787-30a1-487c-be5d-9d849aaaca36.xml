<?xml version="1.0" encoding="utf-8"?>
<TeamMentor_Article Metadata_Hash="-1910766255" Content_Hash="-1239435628">
  <Metadata>
    <Id>5a4ca787-30a1-487c-be5d-9d849aaaca36</Id>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>アプリケーションの条件を越さない信頼性レベルを選択してください</Title>
    <Category>コード アクセス セキュリティ</Category>
    <Phase>設計</Phase>
    <Technology>ASP.NET 3.5</Technology>
    <Type>ガイドライン</Type>
    <DirectLink />
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>行うべき事柄</h1>
  <p>アプリケーションが必要とする稼動権限を決めて、これらの条件を超えない信頼性レベルを選択します。</p>
  <h1>理由</h1>
  <p>攻撃者による被害は、アプリケーションに設定された信頼レベルが定義する範囲のみに影響を及ぼします。 アプリケーションが少ない特権しか持たない場合、攻撃者による被害の可能性は小さくなります。&nbsp;</p>
  <h1>状況</h1>
  <p>ASP.NET ウェブ サービスおよびアプリケーションは、デフォルトでフル トラスト モードで実行します。 アプリケーションでアクセス許可セット全体が必要となることはまれです。 このガイドラインは、アプリケーションで ASP.NET 内で付与可能なアクセス許可セット全体が必要とされない場合はいつでも適用されます。</p>
  <h1>対策</h1>
  <p>最も適当な信頼レベルを選択するには次の手順に従います:</p>
  <ol>
    <li>アプリケーションが必要とするコード アクセス セキュリティ権限の正確なセットを識別します。 これはマニュアル式にコードを見直す、または Permissions Calculator ツール (Permcalc.exe) を使用することで行えます。 <li>アプリケーションに必要なアクセス許可が、標準的な信頼レベルによって与えられるものと合致するかどうかを評価します。 各信頼性レベルのアクセス許可を確認するためには、%windir%\Microsoft.NET\Framework\{version}\CONFIG ディレクトリにある高信頼性レベル方針ファイルである web_hightrust.config から確認してください。 <li>アプリケーションが、高い信頼レベルが提供する許可よりも少ないコード アクセス セキュリティ権限のみを必要とする場合、中程度の信頼を考えてみます。 中程度から低いレベルへ、そして最小レベルへ移行する手順を繰り返します。アプリケーションが求める最適なレベルを見つけるまで、またはアプリケーションによる要求アクセス許可が部分的信頼レベルを少し上回るまで、部分的な信頼レベルを評価します。 <li>お使いのアプリケーションで必要なアクセス許可の数が、あるレベルで付与される許可よりも多いものの、その次のレベルで提供される許可よりも少ない場合は、カスタム信頼ポリシーの作成を検討してください。 <li>Web 構成ファイルに xmlディレクティブを追加することで信頼レベルを設定します:<pre>&lt;system.web&gt;<br />&nbsp; ...<br />&nbsp; &lt;trust level="Medium" originUrl="" /&gt;<br />&nbsp; ...<br />&lt;/system.web&gt;</pre></li></li></li></li></li>
  </ol>
  <h1>問題の例</h1>
  <p>開発者は、アプリケーションのために割り当てられたディレクトリの外へのファイルシステムのアクセスを必要とするASP.NETアプリケーションを作成します。 デフォルトの完全信頼性レベルでは、ファイル システムがアプリケーションの必要に応じてアクセスできるようになっていますが、ソケットへのアクセスやアンマネージ コードの呼び出しといったようないくつかの不要な特権も与えられています。&nbsp;これらの追加の特権は、アプリケーションが危険にさらされる場合に攻撃者が与えることのできる損害の量を増大させます。</p>
  <h1>ソリューションの例</h1>
  <p>開発者は、アプリケーションのために割り当てられたディレクトリの外へのファイルシステムのアクセスを必要とするASP.NETアプリケーションを作成します。 開発者はアプリケーションに完全なアクセス許可を与えたいと考えません。 開発者がアセンブリで permcalc.exe を実行し、それがアプリケーションが必要とする特定のアクセス許可を正確に指定するxml レポートを生成しますが、それらは: </p>
  <ul>
    <li>
      <strong>SMTP アクセス。</strong> アプリケーションを代理して、ユーザーに対してパスワード&nbsp;のリセット確認応答&nbsp;や新規ユーザーへのウェルカム メールといったような重要なイベントの発生について連絡します。 <li><strong>マネージ コードのみ</strong>。アプリケーションは非常にモダンで、タスクの実行にあたってアンマネージ ライブラリに依存しません。 アプリケーションはアンマネージ (ネイティブ) コードを呼び出す必要がありません。 <li><strong>ソケット アクセス。</strong> アプリケーションは、カスタムのソケットベースの通信プロトコルを使用した古い監査パッケージに依存しています。 アプリケーションはソケット接続を確立できる必要があり、データの読み取り/書き込みをそこへ、またはそこから行います。</li></li></li>
  </ul>
  <p>開発者は、定義済み信頼レベルを確認して、アプリケーションで使用することができ、かつアプリケーションの要件を満たしている最低の信頼レベルが high 信頼レベルであると判断します。&nbsp; 開発者は、xml 指令を web config ファイルに追加することで信頼レベルを設定します。</p>
 <pre>&lt;system.web&gt;<br />&nbsp; ...<br />&nbsp; &lt;trust level="High" originUrl="" /&gt;<br />&nbsp; ...<br />&lt;/system.web&gt;</pre>
  <h1>その他のリソース</h1>
  <ul>
    <li>
      <a href="http://msdn2.microsoft.com/en-us/library/ms165077.aspx">Permission Calculator ツール (PermCalc.exe)</a>
    </li>
  </ul>
  <h1>関連する項目</h1>
  <ul>
    <li>
      <a href="/article/c8e5ad95-edef-44fb-9dd4-9bac52064024">選択された信頼性レベルがアプリケーションの条件を越していません</a>
      <li>
        <a href="/article/3c5d8485-26ea-4fca-a76b-6a2f1c5c4509">アプリケーションが更なるアクセス許可の追加を必要とする場合は、信頼性方針をカスタマイズして作成してください</a>
        <li>
          <a href="/article/29d960c8-3bc8-469b-957e-b6845a00f02d">ホストされている環境においては、中レベルの信頼性を使ってアプリケーションを分離します</a>
          <li>
            <a href="/article/fab1733c-61d7-46a8-88c6-2617a643c0d9">データベース アクセスに最小特権アカウントを使用する</a>
            <li>
              <a href="/article/743a34cc-ed5f-4550-8458-4456b9da9bf1">開発者にアプリケーションの信頼性レベルを変更させないでください</a>
            </li>
          </li>
        </li>
      </li>
    </li>
  </ul>
  <hr />
  <p>出典: Microsoft patterns & practices guidance </p>]]></Data>
  </Content>
</TeamMentor_Article>