<?xml version="1.0" encoding="utf-8"?>
<TeamMentor_Article Metadata_Hash="1960021160" Content_Hash="1832837204">
  <Metadata>
    <Id>2c48bbd6-2677-4ab0-80df-57985b90bee4</Id>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>ASP.NET Session State を保護する</Title>
    <Category>セッション管理</Category>
    <Phase>展開</Phase>
    <Technology>ASP.NET 3.5</Technology>
    <Type>ガイドライン</Type>
    <DirectLink />
    <Tag />
    <Security_Demand />
    <Author />
    <Priority>2</Priority>
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>何をするか</h1>
  <p>デフォルト値を変更する、不要なサービスを無効にする、およびアウト オブ プロセス状態サービスを保護することによって、ASP.NET Session State がスニッフィングやゲッシング攻撃から保護されていることを確認します。 セッション状態ポートを 42424 のデフォルト値から変更することを検討します。 アウト オブ プロセス セッション状態管理の使用を選択した場合は、適切なメカニズムを使用して保護します。 最後に、セッション状態サービスがアプリケーションでまったく使用されない場合は、それを無効にする必要があります。</p>
  <h1>理由</h1>
  <p>攻撃者は、既知の攻撃ベクトルを使用してアプリケーションを攻撃することが頻繁にあります。 そのため、これらのサービスを変更または無効にすることでアプリケーションの Attack Surface (攻撃対象領域) を最小化することができます。 攻撃者は、攻撃を受けているアプリケーションについての詳細を学ぶために、最初の試みとして、しばしばポート スキャナを使用します。ポートを変更すると、攻撃の進行を妨げることができます。 攻撃者は、プロセス外セッション状態管理サーバを直接攻撃してシステムへのアクセスを取得する場合があります。 攻撃者はアプリケーションへのアクセスを得るためにはどんな手段でも使います。したがって、セッション状態がアプリケーションで不要な場合は、それをオフにする必要があります。</p>
  <h1>状況</h1>
  <p>アプリケーションがデフォルトのセッション状態ポートを使用する場合は、変更することをお勧めします。 アプリケーションがアウト オブ プロセス状態サービス（mode=StateServer) を使用する場合、次の推奨事項を使用する必要があります。</p>
  <h1>対策</h1>
  <p>アプリケーションの ASP.NET Session State サービスを適切に保護するためには、次の手順を使用します。</p>
  <ol>
    <li>
      <p>
        <strong>デフォルトのセッション状態ポートを変更</strong>: アウト オブ プロセス状態サービスのためのデフォルトのポートを変更すると、攻撃者は状態サービスがどこに存在するのか迅速に発見することができません。</p>
      <p>デフォルトのよく知られているポートの使用を避けるためには、以下のレジストリ鍵を編集して、ポートを変更できます。</p>
 <pre>HKLM\SYSTEM\CurrentControlSet\Services\aspnet_state\Parameters</pre>
      <p>ポート番号はポートの名前が付いた値で定義されます。 レジストリ内のポート番号を、例えば 45678 に変更する場合は、次のように、エレメントの接続文字列も変更する必要があります: stateConnectionString="tcpip=127.0.0.1:45678"</p>
      <li>
        <p>
          <strong>アウト オブ プロセス セッション状態管理を適切にセキュアにする</strong>: すべてのユーザーアカウントと同様に、状態サービスは最小特権の原則を使用して作成される必要があります。 攻撃者が状態サービスの Credential 情報へアクセスを得た場合でも、攻撃者に必要以上に多くの制御を与えたくはありません。</p>
        <ul>
          <li>セッション状態の通信チャネルを保護します。 詳細は <a href="/article/b070122f-f1d1-47da-a378-57f845d5db61">通信リンクの暗号化</a> をご覧ください。 <li>デフォルトのポートの変更を検討してください。 ステップ1を使用して、デフォルトのセッション状態ポートを変更します。 <li>状態接続文字列を暗号化してください。 詳細は <a href="/article/faada3f5-3f50-42fc-b863-5058e3d848cb">構成ファイルの機微データを保護</a> をご覧ください。</li></li></li>
        </ul>
        <li>
          <p>
            <strong>ASP.NET 状態サービスを正しくオフにするには以下の手順を使用します</strong>:</p>
          <ol>
            <li>[管理ツール] -&gt; [インターネット情報サービス] にナビゲートします。 <li>アプリケーションに関連付けられている IIS の適切なインスタンスを選択します。 <li>IIS インスタンスを右クリックして、[プロパティ] を選択します。 <li>[Home Directory] タブで [コンフィグレーション] オプションを選択します。 <li>[オプション] タブを開きます。 <li>"セッション状態を有効化" オプションのチェックをはずします。 <li>[OK] ボタンを押します。</li></li></li></li></li></li></li>
          </ol>
        </li>
      </li>
    </li>
  </ol>
  <h1>問題の例</h1>
  <p>
    <strong>セッション状態のデフォルトのポートを使用する場合は、以下の問題に留意してください。</strong>
  </p>
  <p>MyApp は、ASP.NET 状態サービスを利用する財務アプリケーションです。 ASP.NET State Server は、デフォルトのポート コンフィグレーションで実行しているので、熟練した攻撃者によりこのサービスが容易に検出されて攻撃を受ける可能性があります。 </p>
  <p>
    <strong>アプリケーションによってセッション状態が要求されない場合は、以下の問題に留意してください。</strong>
  </p>
  <p>MyApp は、監視ツールです。  ASP.NET 状態サービスは必要ではないが、管理者はサービスを無効にしていません。 したがって、熟練した攻撃者は、ASP.NET 状態サービスを介してアプリケーションに侵入することができます。</p>
  <h1>ソリューションの例</h1>
  <p>
    <strong>デフォルトのポートが変更された場合</strong>
  </p>
  <p>MyApp は、ASP.NET 状態サービスを利用する財務アプリケーションです。 ASP.NET 状態サーバはカスタム ポート構成で実行されているため、サービスを発見して攻撃するのは熟練した攻撃者にも難しくなります。 </p>
  <p>
    <strong>セッション状態サービスがオフになっている場合</strong>
  </p>
  <p>MyApp は、監視ツールです。 ASP.NET 状態サービスは不要で、管理者はサービスを無効にしています。 したがって熟練した攻撃者は、アプリケーションに侵入する前に MyApp またはそのコンポーネントのいずれかにある、セキュリティ上の脆弱性を見つけなければなりません。</p>
  <h1>その他のリソース</h1>
  <ul>
    <li>ASP.NET 状態サービスの構成に関する詳細は、<a href="http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/0d9dc063-dc1a-46be-8e84-f05dbb402221.mspx">ASP.NET 状態サーバで状態サービスを構成する</a> を参照してください。<li>アウト オブ プロセス状態サービスの構成に関する詳細は、<a href="http://technet2.microsoft.com/WindowsServer/en/library/17866624-359b-4fbf-8a3a-05fb13dee6811033.mspx">ASP.NET 状態サービスを使用してアウト オブ プロセス セッション状態を構成する</a> を参照してください。 <li>ASP.NET web アプリケーションを保護する方法の詳細については、<a href="http://msdn2.microsoft.com/en-us/library/aa302435.aspx#c19618429_013">ASP.NET アプリケーションと Web サービスをセキュアにする</a> を参照してください。</li></li></li>
  </ul>
  <h1>関連する項目</h1>
  <ul>
    <li>
      <a href="/article/b070122f-f1d1-47da-a378-57f845d5db61">ガイドライン：通信リンクの暗号化 </a>
      <li>
        <a href="/article/faada3f5-3f50-42fc-b863-5058e3d848cb">ガイドライン：構成ファイルの機微データを保護 </a>
        <li>
          <a href="/article/254ddab5-ecd2-4e05-a2b0-861e970bc0d9">ガイドライン：セッション Cookie の保護 </a>
          <li>
            <a href="/article/fab1733c-61d7-46a8-88c6-2617a643c0d9">ガイドライン：データベース アクセスに最小限の特権アカウントを使用</a>
            <li>
              <a href="/article/4891b0a0-9843-463c-9d5e-addc3804bdde">チェックリスト項目：ASP.NET Session State が保護されている </a>
            </li>
          </li>
        </li>
      </li>
    </li>
  </ul>
  <hr />
  <p>出典: Microsoft Patterns &amp; Practices ガイダンス </p>]]></Data>
  </Content>
</TeamMentor_Article>