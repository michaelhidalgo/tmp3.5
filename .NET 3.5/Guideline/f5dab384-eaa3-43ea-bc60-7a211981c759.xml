<?xml version="1.0" encoding="utf-8"?>
<TeamMentor_Article Metadata_Hash="611866783" Content_Hash="-411770807">
  <Metadata>
    <Id>f5dab384-eaa3-43ea-bc60-7a211981c759</Id>
    <Library_Id>92718d53-36b2-47bc-b6f5-e60994385f46</Library_Id>
    <Title>アンマネージ コードに危険な可能性のある API がないかどうか検証する</Title>
    <Category>アンマネージ コード</Category>
    <Phase>実装</Phase>
    <Technology>.NET 3.5</Technology>
    <Type>ガイドライン</Type>
    <DirectLink />
    <Tag />
    <Security_Demand />
    <Author />
    <Priority />
    <Status />
    <Source>SI</Source>
  </Metadata>
  <Content Sanitized="true" DataType="Html">
    <Data><![CDATA[<h1>行うべき事柄</h1>アプリケーションに含まれるアンマネージ コードを徹底的にコード レビューする<h1>理由</h1><p>アンマネージ コードには、バッファ オーバーフローが含まれていたり、セキュリティ脆弱性をもたらす危険なAPIの使用がある可能性があります。 </p><h1>状況</h1><p>アンマネージ コードを呼び出して、ソースにアクセスする場合｡</p><h1>対策</h1><p>アンマネージ コードをレビューし、<b>strcpy</b> および <b>strcat</b>などの潜在的に危険な APIの使用がないかを確認します。潜在的な危険な API の完全なリストは下記のとおりです。 インターロップコール、およびアンマネージ コードそのものをレビューし、誤った推測をして、実行制御がマネージからアンマネージコードにわたっていないかを確認します。</p><p />潜在的に危険な非管理型関数は以下の様に分類できます。<ul><li><b>境界のない関数 (UF): </b> これらの関数は、変更される可能性のあるバイト数について、明確なバウンド パラメータを、パラメータの 1つとして想定していません。 一般的にこれらは潜在的に最も危険な関数であり、決して使用しないでください。 <li><b>NULL 終端関数 (NTF): </b> これらの関数は NULL 終端文字列を必要とします。 NULL 終端のない文字列が提供された場合、メモリーを上書きする可能性があります。 NULL 終端関数をコードで使用する場合、ループに NULL のための追加プレースホルダーがないことを確認してください。 例えば、(i = 0; i &lt;= 512; i++) は、&lt;= 512 ではなく &lt; 512 である必要があります。 <li><b>非 NULL 終端関数 (NNTF):</b> ほとんどの文字列関数の出力は NULL 終端です。 ただし、一部の出力は異なります。 プログラムの不具合を防ぐため、これらには特別な対処が必要です。 コードが非 NULL 終端関数を使用する場合、ループに NULL のための追加プレースホルダ―があることを確認してください。 <li><b>書式関数 (FF): </b> 書式文字列関数により、プログラマーは入出力の書式を設定できます。 書式が提供されない場合、データが操作され、プログラミングに不具合が発生する可能性があります。 </li></li></li></li></ul><p>以下の表に、潜在的に危険な非管理型の様々な API とそれぞれが関連するカテゴリーを示します。</p><p><b>潜在的に危険な非管理型API</b></p><p><table><tbody><tr><th>関数</th><th>カテゴリ</th></tr><tr><td>Strcpy</td><td>UF、NTF</td></tr><tr><td>Strcat</td><td>UF、NTF</td></tr><tr><td>Strcat</td><td>NTF</td></tr><tr><td>Strlen</td><td>NTF</td></tr><tr><td>Strncpy</td><td>NNTF</td></tr><tr><td>Strncat</td><td>NTF</td></tr><tr><td>Strcmp</td><td>NTF</td></tr><tr><td>Strcmp</td><td>NTF</td></tr><tr><td>Mbcstows</td><td>NNTF</td></tr><tr><td>_strdup</td><td>NTF</td></tr><tr><td>_strrev</td><td>NTF</td></tr><tr><td>Strstr</td><td>NTF</td></tr><tr><td>Strstr</td><td>NTF</td></tr><tr><td>Sprintf</td><td>FF、NTF</td></tr><tr><td>_snprintf </td><td>FF、NTF</td></tr><tr><td>Printf</td><td>FF、NTF</td></tr><tr><td>Fprintf</td><td>FF、NTF</td></tr><tr><td>Gets</td><td>UF</td></tr><tr><td>Scanf</td><td>FF、NTF</td></tr><tr><td>Fscanf</td><td>FF、NTF</td></tr><tr><td>Sscanf</td><td>FF、NTF</td></tr><tr><td>Strcspn</td><td>NTF</td></tr><tr><td>MultiByteToWideChar</td><td>NNTF</td></tr><tr><td>WideCharToMultiByte</td><td>NNTF</td></tr><tr><td>GetShortPathNameW</td><td>NTF</td></tr><tr><td>GetLongPathNameW</td><td>NTF</td></tr><tr><td>WinExec</td><td>NTF</td></tr><tr><td>CreateProcessW</td><td>NTF</td></tr><tr><td>GetEnvironmentVariableW</td><td>NTF</td></tr><tr><td>SetEnvironmentVariableW</td><td>NTF</td></tr><tr><td>SetEnvironmentVariableW</td><td>NTF</td></tr><tr><td>ExpandEnvironmentStringsW</td><td>NTF</td></tr><tr><td>SearchPathW</td><td>NTF</td></tr><tr><td>SearchPathW</td><td>NTF</td></tr><tr><td>SearchPathW</td><td>NTF</td></tr><tr><td>Lstrcpy</td><td>UF、NTF</td></tr><tr><td>Wcscpy</td><td>UF、NTF</td></tr><tr><td>_mbscpy</td><td>UF、NTF</td></tr><tr><td>StrCpyA</td><td>UF、NTF</td></tr><tr><td>StrCpyW</td><td>UF、NTF</td></tr><tr><td>lstrcatA</td><td>UF、NTF</td></tr><tr><td>lstrcatW</td><td>UF、NTF</td></tr><tr><td>Wcscat</td><td>UF、NTF</td></tr><tr><td>_mbscat</td><td>UF、NTF</td></tr><tr><td>Wcslen</td><td>NTF</td></tr><tr><td>_mbslen</td><td>NTF</td></tr><tr><td>_mbstrlen</td><td>NTF</td></tr><tr><td>lstrlenA</td><td>NTF</td></tr><tr><td>lstrlenW</td><td>NTF</td></tr><tr><td>Wcsncpy</td><td>NNTF</td></tr><tr><td>_mbsncpy</td><td>NNTF</td></tr><tr><td>StrCpyN</td><td>NNTF</td></tr><tr><td>lstrcpynW</td><td>NTF</td></tr><tr><td>lstrcatnA</td><td>NTF</td></tr><tr><td>lstrcatnW</td><td>NTF</td></tr><tr><td>Wcsncat</td><td>NTF</td></tr><tr><td>_mbsncat</td><td>NTF</td></tr><tr><td>_mbsnbcat</td><td>NTF</td></tr><tr><td>lstrcmpA</td><td>NTF</td></tr><tr><td>lstrcmpW</td><td>NTF</td></tr><tr><td>StrCmp</td><td>NTF</td></tr><tr><td>Wcscmp</td><td>NTF</td></tr><tr><td>_mbscmp</td><td>NTF</td></tr><tr><td>Strcoll</td><td>NTF</td></tr><tr><td>Wcscoll</td><td>NTF</td></tr><tr><td>_mbscoll</td><td>NTF</td></tr><tr><td>_stricmp</td><td>NTF</td></tr><tr><td>lstrcmpiA</td><td>NTF</td></tr><tr><td>lstrcmpiW</td><td>NTF</td></tr><tr><td>_wcsicmp</td><td>NTF</td></tr><tr><td>_mbsicmp</td><td>NTF</td></tr><tr><td>StrCmp</td><td>NTF</td></tr><tr><td>_stricoll</td><td>NTF</td></tr><tr><td>_wcsicoll</td><td>NTF</td></tr><tr><td>_mbsicoll</td><td>NTF</td></tr><tr><td>StrColl</td><td>NTF</td></tr><tr><td>_wcsdup</td><td>NTF</td></tr><tr><td>_mbsdup</td><td>NTF</td></tr><tr><td>StrDup</td><td>NTF</td></tr><tr><td>_wcsrev</td><td>NTF</td></tr><tr><td>_mbsrev</td><td>NTF</td></tr><tr><td>_strlwr</td><td>NTF</td></tr><tr><td>_mbslwr</td><td>NTF</td></tr><tr><td>_wcslwr</td><td>NTF</td></tr><tr><td>_strupr</td><td>NTF</td></tr><tr><td>_mbsupr</td><td>NTF</td></tr><tr><td>_wcsupr</td><td>NTF</td></tr><tr><td>Wcsstr</td><td>NTF</td></tr><tr><td>_mbsstr</td><td>NTF</td></tr><tr><td>Strspn</td><td>NTF</td></tr><tr><td>Wcsspn</td><td>NTF</td></tr><tr><td>_mbsspn</td><td>NTF</td></tr><tr><td>Strpbrk</td><td>NTF</td></tr><tr><td>Wcspbrk</td><td>NTF</td></tr><tr><td>_mbspbrk</td><td>NTF</td></tr><tr><td>Wcsxfrm</td><td>NTF</td></tr><tr><td>Wcscspn</td><td>NTF</td></tr><tr><td>_mbcscpn</td><td>NTF</td></tr><tr><td>Swprintf</td><td>FF</td></tr><tr><td>wsprintfA </td><td>FF</td></tr><tr><td>wsprintfW </td><td>FF</td></tr><tr><td>Vsprintf</td><td>FF</td></tr><tr><td>Vswprintf</td><td>FF</td></tr><tr><td>_snwprintf </td><td>FF</td></tr><tr><td>_vsnprintf </td><td>FF</td></tr><tr><td>_vsnwprintf </td><td>FF</td></tr><tr><td>Vprintf</td><td>FF</td></tr><tr><td>Vwprintf</td><td>FF</td></tr><tr><td>Vfprintf</td><td>FF</td></tr><tr><td>Vwfprintf</td><td>FF</td></tr><tr><td>_getws</td><td>UF</td></tr><tr><td>Fwscanf</td><td>FF</td></tr><tr><td>Wscanf</td><td>FF</td></tr><tr><td>Swscanf</td><td>FF</td></tr><tr><td>OemToCharA</td><td>UF、NTF</td></tr><tr><td>OemToCharW</td><td>UF、NTF</td></tr><tr><td>CharToOemA</td><td>UF、NTF</td></tr><tr><td>CharToOemW</td><td>UF、NTF</td></tr><tr><td>CharUpperA</td><td>NTF</td></tr><tr><td>CharUpperW</td><td>NTF</td></tr><tr><td>CharUpperBuffW</td><td>NTF</td></tr><tr><td>CharLowerA</td><td>NTF</td></tr><tr><td>CharLowerW</td><td>NTF</td></tr><tr><td>CharLowerBuffW</td><td>NTF</td></tr></tbody></table></p><h1>その他のリソース</h1><ul><li><div>セキュリティコード レビューに関する詳細な情報は、<a href="http://msdn.microsoft.com/library/en-us/dnpag2/html/PAGHT000027.asp">方法: マネージコードのセキュリティコード レビューを行うを参照してください。</a></div></li></ul><h1>関連する項目</h1><ul><li><div>チェックリスト項目: 潜在的に危険なAPIについてアンマネージ コードを検査</div></li></ul><hr /><p>出典: Microsoft patterns & practices guidance</p>]]></Data>
  </Content>
</TeamMentor_Article>